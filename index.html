<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Room Status Extractor</title>
  <script src="https://unpkg.com/tesseract.js@v2.1.5/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background: #f9f9f9;
      text-align: center;
    }

    h2 {
      margin-bottom: 1rem;
    }

    input[type="file"] {
      margin-top: 1rem;
    }

    img {
      max-width: 90%;
      margin: 1rem auto;
      display: block;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #result {
      white-space: pre-wrap;
      text-align: left;
      background: #fff;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 500px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h2>Room Status from Image</h2>
  <input type="file" accept="image/*" onchange="handleImage(event)" />
  <img id="preview" style="display:none;" />
  <div id="result">Upload a photo of the meeting room screen to begin</div>

  <script>
    function handleImage(event) {
      const file = event.target.files[0];
      if (!file) return;

      const preview = document.getElementById("preview");
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";

      document.getElementById("result").innerText = "🔍 Processing...";

      Tesseract.recognize(
        file,
        'eng',
        { logger: m => console.log(m) }
      ).then(({ data: { text } }) => {
        const output = parseText(text);
        document.getElementById("result").innerText = output;
      });
    }

    function parseText(text) {
      const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
      let result = "";
      let room = null;
      let status = null;
      let endTime = null;

      // Match formats like: T1-9F-C08 or T1-9F-C08(10)
      const roomRegex = /T1-\dF-C\d{2}(\(\d+\))?/;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        // 1. Find Room Name
        if (!room && roomRegex.test(line)) {
          room = line.match(roomRegex)[0];
        }

        // 2. Determine sta
